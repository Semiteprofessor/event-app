generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * Enums
 */
enum Gender {
  male
  female
  other
}

enum Role {
  SUPER_ADMIN
  ADMIN
  USER
  VENDOR
}

enum ShopStatus {
  approved
  pending
  in_review
  action_required
  blocked
  rejected
}

enum PaymentMethod {
  Paystack
  Flutterwave
  Stripe
  PayPal
  COD
}

enum OrderStatus {
  pending
  on_the_way
  delivered
  canceled
  returned
}

enum DiscountType {
  fixed
  percent
}

enum CompaignStatus {
  enable
  disable
}

enum CouponType {
  percent
  fixed
}

enum CurrencyStatus {
  active
  disabled
}

enum PaymentStatus {
  pending
  paid
  hold
}

enum PaymentType {
  monthly
  other
}

/**
 * Models
 */

model User {
  id               String  @id @default(cuid())
  firstName        String
  lastName         String
  email            String  @unique
  password         String
  gender           Gender?
  coverId          String?
  coverUrl         String?
  coverBlurDataURL String?

  // relations
  wishlist          Product[] @relation("Wishlist")
  orders            Order[]
  shops             Shop[]    @relation("VendorShops")
  recentProducts    Product[] @relation("RecentProducts")
  likedProducts     Product[] @relation("LikedProducts")
  purchasedProducts Product[] @relation("PurchasedProducts")

  refreshTokens  RefreshToken[]
  productReviews ProductReview[]
  reviews        Review[]

  followingShops Shop[] @relation("ShopFollowers")

  phone   String
  status  String?
  address String?
  city    String?
  zip     String?
  country String?
  state   String?
  about   String?

  isVerified    Boolean   @default(false)
  otp           String?
  lastOtpSentAt DateTime?
  commission    Float?

  role Role @default(USER)

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model Product {
  id              String      @id @default(cuid())
  name            String?
  code            String?
  status          String?
  isFeatured      Boolean?    @default(false)
  brandId         String?
  brand           Brand?      @relation(fields: [brandId], references: [id])
  likes           Int?        @default(0)
  description     String?
  metaTitle       String?
  metaDescription String?
  slug            String      @unique
  categoryId      String
  category        Category    @relation(fields: [categoryId], references: [id])
  subCategoryId   String
  subCategory     SubCategory @relation(fields: [subCategoryId], references: [id])
  gender          String?
  tags            String[]    @default([])
  sku             String
  price           Float
  priceSale       Float
  oldPriceSale    Float?
  available       Int
  sold            Int         @default(0)

  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])

  reviews ProductReview[]
  images  ProductImage[]

  colors String[] @default([])
  sizes  String[] @default([])

  // many-to-many reverse sides
  wishlistedBy User[] @relation("Wishlist")
  recentUsers  User[] @relation("RecentProducts")
  likedBy      User[] @relation("LikedProducts")
  purchasedBy  User[] @relation("PurchasedProducts")

  // campaign relation (explicit join table)
  ProductOnCompaign ProductOnCompaign[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductImage {
  id          String  @id @default(cuid())
  url         String
  imageId     String
  blurDataURL String
  productId   String
  product     Product @relation(fields: [productId], references: [id])
}

model ProductReview {
  id        String  @id @default(cuid())
  userId    String
  user      User    @relation(fields: [userId], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])

  review      String
  rating      Int
  isPurchased Boolean

  images ReviewImage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ReviewImage {
  id          String        @id @default(cuid())
  url         String
  blurDataURL String
  reviewId    String
  review      ProductReview @relation(fields: [reviewId], references: [id])
}

model Review {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  rating      Int
  review      String
  designation String
  createdAt   DateTime @default(now())
}

model Category {
  id              String @id @default(cuid())
  name            String @db.VarChar(100)
  metaTitle       String @db.VarChar(100)
  description     String @db.VarChar(500)
  metaDescription String @db.VarChar(200)
  slug            String @unique
  status          String

  coverId          String
  coverUrl         String
  coverBlurDataURL String

  subCategories SubCategory[]
  products      Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SubCategory {
  id String @id @default(cuid())

  coverId          String
  coverUrl         String
  coverBlurDataURL String

  name            String @db.VarChar(100)
  metaTitle       String @db.VarChar(100)
  description     String @db.VarChar(500)
  metaDescription String @db.VarChar(200)
  slug            String
  status          String

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Brand {
  id              String    @id @default(cuid())
  logoId          String
  logoUrl         String
  logoBlurDataURL String
  name            String
  metaTitle       String
  description     String
  metaDescription String
  slug            String    @unique
  status          String
  products        Product[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Shop {
  id String @id @default(cuid())

  // vendor relation (one user can have many shops)
  vendorId String
  vendor   User   @relation("VendorShops", fields: [vendorId], references: [id])

  logoId          String
  logoUrl         String
  logoBlurDataURL String

  coverId          String
  coverUrl         String
  coverBlurDataURL String

  title           String
  metaTitle       String
  description     String
  metaDescription String
  slug            String  @unique
  phone           String  @unique
  website         String?

  approved   Boolean   @default(false)
  approvedAt DateTime?

  status  ShopStatus
  message String?

  country       String
  city          String
  state         String
  streetAddress String

  paymentHolderName  String
  paymentHolderEmail String
  paymentBankName    String
  paymentAccountNo   Int

  // followers: many-to-many between Shop and User
  followers User[]    @relation("ShopFollowers")
  products  Product[]
  payments  Payment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id            String        @id @default(cuid())
  paymentMethod PaymentMethod
  orderNo       String
  paymentId     String?
  payment       Payment?      @relation("PaymentOrders", fields: [paymentId], references: [id])

  subTotal       Float
  total          Float
  totalItems     Int
  shipping       Float
  discount       Float?
  currency       String
  conversionRate Float
  status         OrderStatus?
  items          Json?
  note           String?

  userId String
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Compaign {
  id            String @id @default(cuid())
  coverId       String
  coverUrl      String
  coverBlurData String

  name            String @db.VarChar(100)
  metaTitle       String @db.VarChar(100)
  description     String @db.VarChar(500)
  metaDescription String @db.VarChar(200)
  slug            String @unique

  startDate DateTime
  endDate   DateTime

  discountType DiscountType
  discount     Float
  status       CompaignStatus @default(enable)

  products ProductOnCompaign[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductOnCompaign {
  compaignId String
  productId  String

  compaign Compaign @relation(fields: [compaignId], references: [id])
  product  Product  @relation(fields: [productId], references: [id])

  @@id([compaignId, productId])
}

model CouponCode {
  id          String     @id @default(cuid())
  name        String
  code        String     @unique
  discount    Float
  expire      DateTime
  description String?
  type        CouponType
  usedBy      String[]   @default([])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Currency {
  id      String         @id @default(cuid())
  name    String
  code    String         @unique
  country String
  status  CurrencyStatus @default(active)
  rate    Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Newsletter {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Notification {
  id            String        @id @default(cuid())
  opened        Boolean
  title         String
  orderId       String
  coverId       String?
  coverUrl      String?
  city          String
  paymentMethod PaymentMethod
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Payment {
  id     String @id @default(cuid())
  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])

  orders Order[] @relation("PaymentOrders")

  total           Float
  totalCommission Float
  totalIncome     Float
  status          PaymentStatus @default(pending)
  paidAt          DateTime?
  tip             Float?
  type            PaymentType   @default(monthly)
  date            DateTime      @default(now())
  message         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
